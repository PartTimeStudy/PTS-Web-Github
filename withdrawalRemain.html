<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채권 신고 확인</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>채권 신고 확인</h1>

        <div id="withdrawalInfoSection" style="margin-top: 30px; padding: 20px; background: #1a1a1a; border-radius: 8px; border: 1px solid #404040;">
            <div style="color: #e0e0e0; line-height: 1.8; margin-bottom: 30px; font-size: 14px; text-align: center;">
                <p>등록해주신 채권은 법원과 파산관재인의 절차에 따라 공정하게 심사되고 배당될 수 있도록 회사는 끝까지 성실히 협조하겠습니다.</p>
            </div>

            <div style="color: #e0e0e0; line-height: 1.8; margin-bottom: 30px; font-size: 14px;">
                <div style="padding: 15px; background: #2d2d2d; border-radius: 6px;">
                    <div style="margin-bottom: 12px;"><strong>성명:</strong> <span id="userName"></span></div>
                    <div style="margin-bottom: 12px;"><strong>연락처:</strong> <span id="userPhone"></span></div>
                    <div style="margin-bottom: 12px;"><strong>채권 (보증금):</strong> <span id="remainingDeposit"></span></div>
                    <div style="margin-bottom: 12px;">
                        <strong>채권 (상금):</strong> <span id="remainingPrize"></span>
                        <span id="prizeNotice" style="display: none; margin-left: 8px; color: #999; font-size: 12px;"></span>
                    </div>
                    <div><strong>주소:</strong> <span id="address"></span></div>
                </div>
            </div>

            <div id="message" class="message" style="margin-bottom: 15px;"></div>
            <button type="button" class="btn" id="confirmBtn" style="width: 100%;">확인</button>
            <button type="button" class="btn" id="closeBtn" style="display: none; width: 100%; background: #2d2d2d; border: 1px solid #404040;">닫기</button>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #404040;">
                <div style="color: #999; font-size: 12px; line-height: 1.6;">
                    <p style="margin-bottom: 15px; font-weight: 600; color: #e0e0e0;">*추가 안내</p>
                    <p style="margin-bottom: 10px;">- 본 안내문은 회사가 법원에 제출할 채권자 목록을 보다 정확하게 작성하기 위한 사전 채권 정보 제출 절차에 관한 것이며, 향후 법원 및 파산관재인의 안내에 따라 별도의 정식 채권 신고 절차가 진행될 수 있습니다.</p>
                    <p style="margin-bottom: 10px;">- 회사는 파트타임 스터디 서비스 내 이용·결제·보증금·상금 내역 등 기존 데이터베이스에 기반하여 채권자 목록을 작성하게 됩니다. 따라서 채권자 등록을 직접 하지 않으신 경우에도, 회사가 보유한 서비스 DB에 따라 보유 보증금 및 채권 금액이 채권자 목록에 반영될 수 있습니다.</p>
                    <p>- 채권자 등록을 통해 수집되는 개인정보는 파산 신청 및 파산절차 진행을 위한 채권자 목록 작성, 법원 및 파산관재인의 채권자 통지·연락 목적에 한하여 사용되며, 관련 법령에서 정한 보존 기간 경과 후에는 지체 없이 안전한 방법으로 파기할 예정입니다.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="version-info" id="versionInfo"></div>
    
    <div class="snackbar" id="bondRegistrationSnackbar">
        <div style="font-weight: 600; margin-bottom: 12px; font-size: 16px;">채권 등록이 완료되었습니다.</div>
        <div style="margin-bottom: 8px;">절차에 따라 공정하게 심사되고 배당될 수 있도록 노력하겠습니다.</div>
        <div style="margin-top: 12px; font-size: 13px;">다시 한번 죄송합니다.</div>
    </div>

    <script src="js/shared.js"></script>
    <script src="js/withdrawal.js"></script>
    <script src="js/withdrawalRemain.js"></script>
    <script>
        // 버전 정보 표시 (dev 환경에서만)
        const versionInfoEl = document.getElementById('versionInfo');
        if (isDevEnvironment()) {
            versionInfoEl.textContent = `v${APP_VERSION} (${BUILD_DATE})`;
        } else {
            versionInfoEl.style.display = 'none';
        }

        // 채권 등록 완료 스낵바 표시 함수
        function showBondRegistrationSnackbar() {
            const snackbar = document.getElementById('bondRegistrationSnackbar');
            snackbar.classList.add('show');
            
            // 5초 후 자동으로 숨기기
            setTimeout(() => {
                snackbar.classList.remove('show');
            }, 5000);
        }

        // 페이지 로드 시 정보 표시 및 전송 준비
        document.addEventListener('DOMContentLoaded', async () => {
            const messageEl = document.getElementById('message');
            // 주소와 상세주소를 합쳐서 사용
            const savedAddress = localStorage.getItem('userAddress') || '';
            const savedDetailAddress = localStorage.getItem('userDetailAddress') || '';
            const address = `${savedAddress} ${savedDetailAddress}`.trim();

            try {
                // 유저 정보 조회
                messageEl.className = 'message loading show';
                messageEl.textContent = '정보 조회 중...';

                const userInfo = await getUserInfo();

                // 정보 표시
                document.getElementById('userName').textContent = userInfo.name || '-';
                document.getElementById('userPhone').textContent = userInfo.phone || '-';
                document.getElementById('remainingDeposit').textContent = userInfo.remainDeposit > 0 ? `${userInfo.remainDeposit.toLocaleString()}원` : '0원';
                
                // 상금 표시 및 안내
                const remainingPrize = userInfo.remainPrize || 0;
                const prizeEl = document.getElementById('remainingPrize');
                const prizeNoticeEl = document.getElementById('prizeNotice');
                
                if (remainingPrize > 0) {
                    prizeEl.textContent = `${remainingPrize.toLocaleString()}원`;
                    
                    // 상금이 3000원 미만인 경우 안내 표시
                    if (remainingPrize < 3000) {
                        prizeNoticeEl.textContent = '(3000원 미만으로 채권으로 등록되지 않습니다)';
                        prizeNoticeEl.style.display = 'inline';
                        prizeNoticeEl.style.color = '#ff9800';
                    } else {
                        prizeNoticeEl.style.display = 'none';
                    }
                } else {
                    prizeEl.textContent = '0원';
                    prizeNoticeEl.style.display = 'none';
                }
                
                document.getElementById('address').textContent = address || '-';

                messageEl.className = 'message';
                messageEl.textContent = '';

                const confirmBtn = document.getElementById('confirmBtn');
                const closeBtn = document.getElementById('closeBtn');

                // 닫기 버튼 클릭 시 공지 페이지로 이동
                closeBtn.addEventListener('click', () => {
                    window.location.href = 'notice.html';
                });

                // 확인 버튼 클릭 시 정보 전송
                confirmBtn.addEventListener('click', async () => {
                    try {
                        // 제출 중: 버튼 숨기기
                        confirmBtn.style.display = 'none';
                        messageEl.className = 'message loading show';
                        messageEl.textContent = '정보 전송 중...';

                        await submitFinalInfo({
                            name: userInfo.name,
                            phone: userInfo.phone,
                            deposit: userInfo.remainDeposit,
                            prize: userInfo.remainPrize,
                            address: address
                        });

                        // 제출 완료: 완료 메시지와 닫기 버튼 표시
                        messageEl.className = 'message success show';
                        messageEl.textContent = '정보가 전송되었습니다.';
                        closeBtn.style.display = 'block';
                        
                        // 채권 등록 완료 스낵바 표시
                        showBondRegistrationSnackbar();
                    } catch (error) {
                        // 에러 발생 시: 에러 메시지와 확인 버튼 다시 표시
                        messageEl.className = 'message error show';
                        messageEl.textContent = error.message || '정보 전송에 실패했습니다.';
                        confirmBtn.style.display = 'block';
                        closeBtn.style.display = 'none';
                    }
                });
            } catch (error) {
                messageEl.className = 'message error show';
                messageEl.textContent = error.message || '처리 중 오류가 발생했습니다.';
            }
        });
    </script>
</body>
</html>

